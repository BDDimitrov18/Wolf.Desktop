<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Wolf.Desktop.ViewModels"
             xmlns:conv="using:Wolf.Desktop.Converters"
             x:Class="Wolf.Desktop.Views.EditPlotView"
             x:CompileBindings="False"
             Background="{StaticResource BrushSurface}">

    <UserControl.Resources>
        <conv:ActivityDisplayConverter x:Key="ActivityDisplayConverter"/>
    </UserControl.Resources>

    <ScrollViewer>
        <StackPanel Spacing="0" MaxWidth="720" Margin="32">

            <TextBlock Text="{Binding FormTitle}"
                       FontSize="20" FontWeight="Bold"
                       Margin="0,0,0,28"/>

            <Border IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                    Background="#fceaea"
                    CornerRadius="6"
                    Padding="14,10"
                    Margin="0,0,0,16">
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#b83232" FontSize="12"/>
            </Border>

            <!-- Activity picker (order mode only) -->
            <Border IsVisible="{Binding IsFromOrder}"
                    Background="{StaticResource BrushSurfaceAlt}"
                    CornerRadius="8"
                    Padding="24"
                    Margin="0,0,0,16">
                <StackPanel Spacing="16">
                    <TextBlock Text="ДЕЙНОСТ"
                               FontSize="10" FontWeight="Bold"
                               Foreground="{StaticResource BrushTextMuted}"
                               LetterSpacing="1"/>

                    <StackPanel Spacing="6">
                        <TextBlock Text="Дейност" FontSize="12" FontWeight="Medium"/>
                        <ComboBox ItemsSource="{Binding AvailableActivities}"
                                  SelectedItem="{Binding SelectedActivity}"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding ., Converter={StaticResource ActivityDisplayConverter}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Plot details -->
            <Border Background="{StaticResource BrushSurfaceAlt}"
                    CornerRadius="8"
                    Padding="24"
                    Margin="0,0,0,16">
                <StackPanel Spacing="16">
                    <TextBlock Text="ДЕТАЙЛИ НА ИМОТ"
                               FontSize="10" FontWeight="Bold"
                               Foreground="{StaticResource BrushTextMuted}"
                               LetterSpacing="1"/>

                    <Grid ColumnDefinitions="*,16,*">
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="Номер на имот" FontSize="12" FontWeight="Medium"/>

                            <!-- Order mode: AutoCompleteBox -->
                            <AutoCompleteBox Name="PlotNumberBox"
                                             IsVisible="{Binding IsFromOrder}"
                                             Text="{Binding PlotNumberSearchText, Mode=TwoWay}"
                                             ItemsSource="{Binding AvailableExistingPlots}"
                                             ValueMemberBinding="{Binding Plotnumber}"
                                             Watermark="Търсене по номер..."
                                             FilterMode="Contains"
                                             MinimumPrefixLength="1"/>

                            <!-- Standalone mode: TextBox -->
                            <TextBox IsVisible="{Binding !IsFromOrder}"
                                     Text="{Binding Plotnumber}"
                                     Watermark="напр. 1234"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Spacing="6">
                            <TextBlock Text="Номер на урегулиран поземлен имот" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Regulatedplotnumber}" Watermark="Незадължително"/>
                        </StackPanel>
                    </Grid>

                    <Grid ColumnDefinitions="*,16,*">
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="Предназначение" FontSize="12" FontWeight="Medium"/>
                            <ComboBox ItemsSource="{Binding DesignationOptions}"
                                      SelectedItem="{Binding Designation}"
                                      IsEditable="False"
                                      HorizontalAlignment="Stretch"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Spacing="6">
                            <!-- intentionally empty for spacing -->
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Location -->
            <Border Background="{StaticResource BrushSurfaceAlt}"
                    CornerRadius="8"
                    Padding="24"
                    Margin="0,0,0,16">
                <StackPanel Spacing="16">
                    <TextBlock Text="МЕСТОПОЛОЖЕНИЕ"
                               FontSize="10" FontWeight="Bold"
                               Foreground="{StaticResource BrushTextMuted}"
                               LetterSpacing="1"/>

                    <Grid ColumnDefinitions="*,16,*">
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="Област" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Locality}" Watermark="Област"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Spacing="6">
                            <TextBlock Text="Община" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Municipality}" Watermark="Община"/>
                        </StackPanel>
                    </Grid>

                    <Grid ColumnDefinitions="*,16,*">
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="Град" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding City}" Watermark="Град"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Spacing="6">
                            <TextBlock Text="Квартал" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Neighborhood}" Watermark="Квартал"/>
                        </StackPanel>
                    </Grid>

                    <Grid ColumnDefinitions="*,16,*,16,Auto">
                        <StackPanel Grid.Column="0" Spacing="6">
                            <TextBlock Text="Улица" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Street}" Watermark="Улица"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Spacing="6" Width="80">
                            <TextBlock Text="Номер" FontSize="12" FontWeight="Medium"/>
                            <TextBox Text="{Binding Streetnumber}" Watermark="#"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Classes="primary"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding IsBusy, Converter={x:Static BoolConverters.Not}}">
                    Запази имот
                </Button>
                <Button Command="{Binding CancelCommand}">Отказ</Button>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
